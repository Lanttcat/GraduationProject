# 数据库设计

## 优点

1. 减少数据冗余
2. 避免数据维护异常
3. 节约存储空间
4. 高效访问（慢查询调优）

## 数据库设计步骤

### 需求分析

1. 数据是什么
2. 数据库有哪些属性

#### 问题

1. 实体和实体之间的关系
2. 实体所包含的属性
3. 那些属性或者属性的组合可以唯一标识一个实体

#### 实例演示

核心模块：用户模块，商品模块，订单模块，购物车模块，供应商模块

用户模块：

1. 包括属性
2. 可选唯一标识属性
3. 存储特点：永久存储，逐渐增加 （注意分档分表，分库，清理等处理）

### 逻辑设计

ER图，对数据库进行建模

1. 把需求分析转化成数据库逻辑模型
2. 通过ER图的形式对逻辑模型进行展示

#### ER图名词

关系：

元组：

属性：

候选码：

主码：

域：

#### 设计范式

常见范式：第一范式，第二范式。第三范式、BC范式

第一范式：数据库 中所有字段都是单一属性，不可再分，要求数据库中的表都是二维表

第二范式：数据库的表中不存在非关键字段对任意候选关键字段的部分函数依赖，即所有单关键字的表都符合第二范式，不符合第二范式的表中会存在插入异常、删除异常、更新异常、数据冗余。解决：把表拆分。

第三范式：第三范式是在第二范式的基础之上，如果数据表中不存在非关键字段，对任意候选关键字段的传递函数依赖则符合第三范式。问题：存在数据冗余，也还存在数据插入更新删除异常。

BC范式：在第三范式基础之上，数据表中如果不存任何字段对任意候选关键字段的传递函数依赖则符合BC范式 

### 物理设计

考虑每种数据库自身的特点。

做什么？

1. 选择合适的数据库管理系统
2. 定义数据库、表及字段的命名规范
3. 根据所选的DBMS系统选择合适的字段类型
4. 反范式化的设计（空间换时间）

#### MySql常用的存储引擎

MyISANM  MEG_MYISAN Innodb Archive Ndb cluster

#### 表及字段的命名规范

1. 可读性选择：使用大小写（注意大小写敏感）
2. 表意性原则
3. 长名原则

#### 数据库字段类型选择原则

1. 优先级：数字类型=》日期类型=》char=》varchar（根据所占的磁盘空间大小排的，1. 数据比较时候，字符串比较慢，2. 书库中以页为单位的，列的长度越小，利于性能提升） 

#### 如何选择主键

1. 区分业务主键与数据库主键
2. 根据数据库类型，考虑主键是否需要顺序增长
3. 主键的字段类型所占空间要尽量小

#### 避免使用外键约束

1. 降低数据导入的效率
2. 增加维护成本
3. 虽然不建议使用外键约束，但是相关的列上一定要建立索引

#### 避免使用触发器

1. 降低数据导入效率
2. 可能出现意想不到的数据异常
3. 是业务逻辑变得复杂

#### 预留字段

严禁使用预留字段

#### 反范式化

### 维护优化

1. 新的需求建表
2. 索引优化
3. 大表拆分

#### 维护数据字典

1. 使用第三方工具对数据字典进行
2. 利用数据库本身的备注字段

#### 维护索引

1. 索引并不是越多越好，减小读写的效率
2. 定期维护索引碎片

#### 维护表结构

1. 5.5之前需要使用工具
2. 之后支持在线表结构变更
3. 控制表的宽度和大小
4. 不要使用select *
5. 控制用户使用自定义函数
6. 不要使用数据库中的全文索引

#### 在适当的时候对表进行水平拆分和垂直拆分

垂直拆分：

 	1. 经常查询的列放到一起
 	2. text，bolo等大字段拆分出到附加表中

水平拆分：

1. 主键hash



